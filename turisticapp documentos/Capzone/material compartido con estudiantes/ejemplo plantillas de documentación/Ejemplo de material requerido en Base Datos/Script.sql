CREATE TABLE REGION(
    nro_region      NUMBER(3)   PRIMARY KEY,
    nombre_region   VARCHAR(40) NOT NULL
);

CREATE TABLE COMUNA(
    id_comuna       NUMBER(3)       PRIMARY KEY,
    nombre_comuna   VARCHAR2(15)    NOT NULL,
    nro_region      NUMBER(2)       NOT NULL,
    CONSTRAINT Comuna_Region_FK 	FOREIGN KEY(nro_region) REFERENCES REGION(nro_region)
);

CREATE TABLE PERSONA(
    rut     VARCHAR2(10) PRIMARY KEY,
    nombre 	VARCHAR2(20) NOT NULL
);


CREATE TABLE TIPO_USUARIO(
	id_tipo_usuario		VARCHAR2(10) PRIMARY KEY,
	dsc_tipo_usuario	VARCHAR2(20) NOT NULL
);

CREATE TABLE USUARIO(
    nombre_usuario  	VARCHAR2(15)    PRIMARY KEY,
    contraseña      	VARCHAR2(30)    NOT NULL,
    rut             	VARCHAR2(10)    NOT NULL,
    contraseña_cambiado	NUMBER(1)		NOT NULL,
    id_tipo_usuario		VARCHAR2(10)	NOT NULL,
    CONSTRAINT Usuario_Persona_fk 		FOREIGN KEY(rut) 			 REFERENCES PERSONA(rut),
    CONSTRAINT Usuario_Tipo_Usuario_FK	FOREIGN KEY(id_tipo_usuario) REFERENCES TIPO_USUARIO(id_tipo_usuario)
);

CREATE TABLE CONTACTO(
    correo_electronico  VARCHAR2(40)    NOT NULL,
    telefono_fijo       VARCHAR2(12),
    telefono_movil      VARCHAR2(12)    NOT NULL,
    rut                 VARCHAR2(10)    NOT NULL,
    CONSTRAINT Contacto_Persona_FK 		FOREIGN KEY(rut) REFERENCES PERSONA(rut)
);

CREATE TABLE DOMICILIO(
    nombre_calle    VARCHAR(30)     	NOT NULL,
    nro_calle       NUMBER(6)       	NOT NULL,
    casa_depto      NUMBER(1)       	NOT NULL,
    nro_depto       VARCHAR2(6),
    rut             VARCHAR2(10)    	NOT NULL,
    id_comuna       NUMBER(3)       	NOT NULL,
    CONSTRAINT Domicilio_Comuna_FK 		FOREIGN KEY(id_comuna)  REFERENCES COMUNA(id_comuna),
    CONSTRAINT Domicilio_Persona_FK		FOREIGN KEY(rut)        REFERENCES PERSONA(rut)
);

CREATE TABLE JURIDICA(
    rut     VARCHAR2(10) 			PRIMARY KEY,
    giro	VARCHAR2(50) 			NOT NULL,
    CONSTRAINT Juridica_Persona_FK 	FOREIGN KEY(rut) REFERENCES PERSONA(rut)
);

CREATE TABLE PROVEEDOR(
    rut             VARCHAR2(10)    PRIMARY KEY,
    id_proveedor    NUMBER(3)       UNIQUE NOT NULL,
    CONSTRAINT Proveedor_Juridica_FK FOREIGN KEY(rut) REFERENCES PERSONA(rut)
);

CREATE TABLE CURRIER(
    id_currier      NUMBER(4)       PRIMARY KEY,
    dsc_currier     VARCHAR2(20)    NOT NULL
);

CREATE TABLE ORDEN_PEDIDO(
    id_pedido       NUMBER(15)      		PRIMARY KEY,
    estado_pedido   VARCHAR2(10)    		NOT NULL,
    fecha_pedido    DATE            		NOT NULL,
    fecha_recepcion DATE,
    id_proveedor   	NUMBER(3)    			NOT NULL,
    id_currier      NUMBER(3)       		NOT NULL,
    CONSTRAINT Orden_Pedido_Proveedor_FK  	FOREIGN KEY(id_proveedor)	REFERENCES PROVEEDOR(id_proveedor),
    CONSTRAINT Orden_Pedido_Currier_FK    	FOREIGN KEY(id_currier)		REFERENCES CURRIER(id_currier)
);

CREATE TABLE FAMILIA_PRODUCTO(
    id_familia_producto NUMBER(3)       PRIMARY KEY,
    dscp_familia        VARCHAR2(20)    NOT NULL
);

CREATE TABLE TIPO_PRODUCTO(
    id_tipo_producto    NUMBER(3)   PRIMARY KEY,
    dsc_tipo_producto   VARCHAR(20) NOT NULL
);

CREATE TABLE PRODUCTO(
    id_producto         NUMBER(17)      		PRIMARY KEY,
    dsc_producto        VARCHAR2(20)    		NOT NULL,
    fecha_vencimiento   DATE            		NOT NULL,
    precio_venta        NUMBER(9)       		NOT NULL,
    precio_compra       NUMBER(9)       		NOT NULL,
    id_familia_producto NUMBER(3)       		NOT NULL,
    id_tipo_producto    NUMBER(3)       		NOT NULL,
    id_proveedor        NUMBER(3)       		NOT NULL,
    CONSTRAINT Producto_Tipo_Producto_FK		FOREIGN KEY(id_familia_producto)    REFERENCES FAMILIA_PRODUCTO(id_familia_producto),
    CONSTRAINT Producto_Familia_Producto_FK		FOREIGN KEY(id_tipo_producto)       REFERENCES TIPO_PRODUCTO(id_tipo_producto),
    CONSTRAINT Producto_Proveedor_FK			FOREIGN KEY(id_proveedor)           REFERENCES PROVEEDOR(id_proveedor)
);

CREATE TABLE STOCK(
    cantidad_actual     NUMBER(3)   NOT NULL,
    cantidad_optima     NUMBER(3)   NOT NULL,
    cantidad_critica    NUMBER(3)   NOT NULL,
    id_producto         NUMBER(17)  NOT NULL,
    CONSTRAINT stock_id_producto_fk FOREIGN KEY(id_producto) REFERENCES PRODUCTO(id_producto)
);

CREATE TABLE FACTURA(
    nro_factura     NUMBER(15)     		 PRIMARY KEY,
    fecha_factura   DATE            	 NOT NULL,
    rut             VARCHAR2(10)   		 NOT NULL,
    id_pedido       NUMBER(15)      	 NOT NULL,
    total 			NUMBER(10)			 NOT NULL,
    CONSTRAINT Factura_Proveedor_FK      FOREIGN KEY(rut)        REFERENCES PROVEEDOR(rut),
    CONSTRAINT Factura_Orden_Pedido_FK	 FOREIGN KEY(id_pedido)  REFERENCES ORDEN_PEDIDO(id_pedido)
);

CREATE TABLE SERVICIO(
    id_servicio     NUMBER(4)       PRIMARY KEY,
    dsc_servicio    VARCHAR2(20)    NOT NULL,
    precio_servico  NUMBER(9)       NOT NULL,
    duracion        NUMBER(1)       NOT NULL
);

CREATE TABLE ISAPRE(
    id_isapre       VARCHAR2(4)		PRIMARY KEY,
    nombre_isapre   VARCHAR2(30)	NOT NULL
);

CREATE TABLE GRUPO_FONASA(
    id_grupo_fonasa     VARCHAR2(4)		PRIMARY KEY,
    dsc_grupo_fonasa    VARCHAR2(15),
    descuento           NUMBER(6,3),
    copago              NUMBER(6,3)
);

CREATE TABLE NATURAL(
    rut                 VARCHAR2(10)    PRIMARY KEY,
    ap_paterno          VARCHAR2(20)    NOT NULL,
    ap_materno          VARCHAR2(20)    NOT NULL,
    fecha_nacimiento    DATE            NOT NULL,
    cant_de_cargas      NUMBER(2)       NOT NULL,
    id_isapre           VARCHAR2(4)     NOT NULL,
    id_grupo_fonasa     VARCHAR2(4)     NOT NULL,
    CONSTRAINT Natural_Persona_FK 		FOREIGN KEY(rut) 				REFERENCES PERSONA(rut),
    CONSTRAINT Natural_Isapre_FK	    FOREIGN KEY(id_isapre) 			REFERENCES ISAPRE(id_isapre),
    CONSTRAINT Natural_Grupo_Fonasa_FK  FOREIGN KEY(id_grupo_fonasa) 	REFERENCES GRUPO_FONASA(id_grupo_fonasa)
);

CREATE TABLE CLIENTE(
    rut VARCHAR2(10) PRIMARY KEY,
    CONSTRAINT cliente_rut_fk FOREIGN KEY (rut) REFERENCES NATURAL(rut)
);

CREATE TABLE CARGO(
    id_cargo    NUMBER(3)   	PRIMARY KEY,
    dsc_cargo   VARCHAR2(20) 	NOT NULL
);

CREATE TABLE EMPLEADO(
    rut         VARCHAR2(10)    	PRIMARY KEY,
    id_cargo    NUMBER(3)       	NOT NULL,
    CONSTRAINT Empleado_Natural_FK 	FOREIGN KEY(rut) 		REFERENCES NATURAL(rut),
    CONSTRAINT Empleado_Cargo_FK	FOREIGN KEY(id_cargo)	REFERENCES CARGO(id_cargo)
);

CREATE TABLE MODULO_TIEMPO(
    id_modulo       NUMBER(20)      		PRIMARY KEY,
    fecha           DATE            		NOT NULL,
    hora_inicio     VARCHAR2(5)            	NOT NULL,
    hora_fin        VARCHAR2(5)         	NOT NULL,
    estado_modulo   VARCHAR2(20)    		NOT NULL,
    rut_empleado    VARCHAR2(10)    		NOT NULL,
    CONSTRAINT Modulo_Tiempo_Empleado_FK	FOREIGN KEY(rut_empleado) REFERENCES EMPLEADO(rut)
)

CREATE TABLE RESERVA(
    id_reserva      NUMBER(24)      	PRIMARY KEY,
    estado_reserva  VARCHAR2(20)    	NOT NULL,
    id_modulo       NUMBER(20)      	NOT NULL,
    id_servicio     NUMBER(4)       	NOT NULL,
    rut_cliente     VARCHAR2(10)    	NOT NULL,
    CONSTRAINT Reserva_Modulo_Tiemp_FK 	FOREIGN KEY(id_modulo) 		REFERENCES MODULO_TIEMPO(id_modulo),
    CONSTRAINT Reserva_Servicio_FK	 	FOREIGN KEY(id_servicio) 	REFERENCES SERVICIO(id_servicio),
    CONSTRAINT Reserva_Cliente_FK	 	FOREIGN KEY(rut_cliente) 	REFERENCES CLIENTE(rut)
);

CREATE TABLE METODO_PAGO(
    id_metodo_pago NUMBER(10) 	PRIMARY KEY,
    dsc_tipo_pago  VARCHAR2(20) NOT NULL
);

CREATE TABLE BOLETA(
    nro_boleta  	NUMBER(10)  		PRIMARY KEY,
    fecha_emision   DATE        		NOT NULL,
    valor_total     NUMBER(9)   		NOT NULL,
    id_reserva      NUMBER(24)  		NOT NULL,
    id_metodo_pago  NUMBER(10)  		NOT NULL,
    CONSTRAINT Boleta_Reserva_FK 		FOREIGN KEY(id_reserva) 	REFERENCES RESERVA(id_reserva),
    CONSTRAINT Boleta_Metodo_Pago_FK 	FOREIGN KEY(id_metodo_pago) REFERENCES METODO_PAGO(id_metodo_pago)
);

CREATE TABLE SITUACION_ECONOMICA(
    rut                 VARCHAR2(10)    		NOT NULL,
    liquidacion_sueldo  BLOB            		NOT NULL,
    CONSTRAINT Situacion_Economica_Natural_FK	FOREIGN KEY(rut) REFERENCES NATURAL(rut)
);

CREATE TABLE EMPLEADO_SERVICIO(
    rut         VARCHAR2(10) 		NOT NULL,
    id_servicio NUMBER(4) 	 		NOT NULL,
    CONSTRAINT EMSR_Empleado_FK  	FOREIGN KEY(rut)            REFERENCES EMPLEADO(rut),
    CONSTRAINT EMSR_Servicio_FK  	FOREIGN KEY(id_servicio)    REFERENCES SERVICIO(id_servicio)
);

CREATE TABLE SERVICIO_PRODUCTO(
    id_servicio     NUMBER(1)   NOT NULL,
    id_producto     NUMBER(17)  NOT NULL,
	cantidad 		NUMBER(1)	NOT NULL,
    CONSTRAINT SRPR_Servicio_FK FOREIGN KEY(id_servicio) REFERENCES SERVICIO(id_servicio),
    CONSTRAINT SRPR_Producto_FK FOREIGN KEY(id_producto) REFERENCES PRODUCTO(id_producto)
);

CREATE TABLE DETALLE_PEDIDO(
    id_pedido   NUMBER(15)  			NOT NULL,
    id_producto NUMBER(17)  			NOT NULL,
	cantidad	NUMBER(2)				NOT NULL,
    CONSTRAINT Detalle_Orden_Pedido_FK 	FOREIGN KEY (id_pedido)		REFERENCES ORDEN_PEDIDO(id_pedido),
    CONSTRAINT Detalle_Producto_FK	 	FOREIGN KEY(id_producto)	REFERENCES PRODUCTO(id_producto)
);

--Testing

INSERT INTO REGION VALUES(13,'Region Metropolitana');

INSERT INTO COMUNA VALUES(070, 'SANTIAGO', 13);
INSERT INTO COMUNA VALUES(081, 'QUINTA NORMAL', 13);
INSERT INTO COMUNA VALUES(094, 'MAIPU', 13);

INSERT INTO PERSONA VALUES('19133540-6','Enzo');
INSERT INTO PERSONA VALUES('19512887-1','Laura');
INSERT INTO PERSONA VALUES('18838881-7','Yerko');

INSERT INTO DOMICILIO VALUES('AV 4 PONIENTE','121',0,'','19512887-1',094);
INSERT INTO DOMICILIO VALUES('CONDOR','1394',1,'902','19133540-6',070);
INSERT INTO DOMICILIO VALUES('PROF FUENTES MATURANA','5793',0,'','18838881-7',081);

INSERT INTO CONTACTO VALUES('aleksander.zombie@gmail.com','','955331698','19133540-6');
INSERT INTO CONTACTO VALUES('lau.merino@alumnos.duoc.cl','','000000000','19512887-1');
INSERT INTO CONTACTO VALUES('ye.arredondo@alumnos.duoc.cl','','000000000','18838881-7');

INSERT INTO ISAPRE VALUES('NONE','NINGUNA');
INSERT INTO ISAPRE VALUES('COL','COLMENA');
INSERT INTO ISAPRE VALUES('BANM','BANMEDICA');
INSERT INTO ISAPRE VALUES('CONS','CONSALUD');

INSERT INTO GRUPO_FONASA VALUES('NONE','NINGUNO',0,0);
INSERT INTO GRUPO_FONASA VALUES('GPA','GRUPO A',100,0);
INSERT INTO GRUPO_FONASA VALUES('GPB','GRUPO B',90,10);
INSERT INTO GRUPO_FONASA VALUES('GPC','GRUPO C',80,20);
INSERT INTO GRUPO_FONASA VALUES('GPD','GRUPO D',70,30);

INSERT INTO NATURAL VALUES('19133540-6','Lopez','Betancourt','10/06/1995','0','NONE','GPA');
INSERT INTO NATURAL VALUES('19512887-1','Merino','Quezada','19/08/1996','0','NONE','GPB');
INSERT INTO NATURAL VALUES('18838881-7','Arredondo','Castro','17/12/1994','0','NONE','GPC');

INSERT INTO CLIENTE VALUES('19133540-6');

INSERT INTO CARGO VALUES(001,'Administrador');
INSERT INTO CARGO VALUES(002,'Secretari@');
INSERT INTO CARGO VALUES(003,'Dentista');

INSERT INTO EMPLEADO VALUES('19512887-1',001);
INSERT INTO EMPLEADO VALUES('18838881-7',003);

INSERT INTO MODULO_TIEMPO VALUES('220418090001','22/04/2018','09:00','09:30','Ocupado','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418093001','22/04/2018','09:31','10:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418100001','22/04/2018','10:01','10:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418103001','22/04/2018','10:31','11:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418110001','22/04/2018','11:01','11:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418113001','22/04/2018','11:31','12:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418120001','22/04/2018','12:01','12:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418123001','22/04/2018','12:31','13:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418130001','22/04/2018','13:01','13:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418133001','22/04/2018','13:31','14:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418140001','22/04/2018','14:01','14:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418143001','22/04/2018','14:31','15:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418150001','22/04/2018','15:01','15:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418153001','22/04/2018','15:31','16:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418160001','22/04/2018','16:01','16:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418163001','22/04/2018','16:31','17:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418170001','22/04/2018','17:01','17:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418173001','22/04/2018','17:31','18:00','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418180001','22/04/2018','18:01','18:30','Libre','18838881-7');
INSERT INTO MODULO_TIEMPO VALUES('220418183001','22/04/2018','18:31','19:00','Libre','18838881-7');

INSERT INTO SERVICIO VALUES(0001,'Peridoncia',10000,1);
INSERT INTO SERVICIO VALUES(0002,'Ortodoncia General',25000,2);
INSERT INTO SERVICIO VALUES(0003,'Blanqueamiento',15000,1);
INSERT INTO SERVICIO VALUES(0004,'Implantes',50000,3);
INSERT INTO SERVICIO VALUES(0005,'Cirugia Maxilofacial',30000,2);
INSERT INTO SERVICIO VALUES(0006,'Protesis Fija',40000,2);

INSERT INTO EMPLEADO_SERVICIO VALUES('18838881-7',1);

INSERT INTO RESERVA VALUES(220418090001191335406,'Pagada',220418090001,1,'19133540-6');

INSERT INTO CURRIER VALUES(1,'DHL');
INSERT INTO CURRIER VALUES(2,'CHILE EXPRESS');
INSERT INTO CURRIER VALUES(3,'UPS');
INSERT INTO CURRIER VALUES(4,'CORREOS CHILE');
INSERT INTO CURRIER VALUES(5,'STARKEN');
INSERT INTO CURRIER VALUES(6,'TURBBUS CARGO');
INSERT INTO CURRIER VALUES(7,'WESTERN UNION');

INSERT INTO METODO_PAGO VALUES(1, 'EFECTIVO');
INSERT INTO METODO_PAGO VALUES(2, 'CHEQUE');
INSERT INTO METODO_PAGO VALUES(3, 'DEBITO');
INSERT INTO METODO_PAGO VALUES(4, 'CREDITO');

INSERT INTO TIPO_USUARIO VALUES ('ADMIN','Administrativo');
INSERT INTO TIPO_USUARIO VALUES ('SCTR','Secretari@');
INSERT INTO TIPO_USUARIO VALUES ('CLT','Cliente');
INSERT INTO TIPO_USUARIO VALUES ('MDC','Medico');

INSERT INTO USUARIO VALUES('ENZO.LOPEZ','123456','19133540-6',0,'CLT');
INSERT INTO USUARIO VALUES('LEU.MERINO','654321','19512887-1',0,'ADMIN');
INSERT INTO USUARIO VALUES('YER.ARREDONDO','987852','18838881-7',0,'MDC');

INSERT INTO BOLETA VALUES(1,'24/04/2018',10000,220418090001191335406,1);

INSERT INTO PERSONA VALUES('78333650-2','DENTAL AMERICA');
INSERT INTO DOMICILIO VALUES('AV 4 PONIENTE','121',0,'','19512887-1',094);
INSERT INTO JURIDICA VALUES('78333650-2','Importadora & Distribuidora');
INSERT INTO PROVEEDOR VALUES('78333650-2', 200);

INSERT INTO TIPO_PRODUCTO VALUES(1,'IMPLANTES');
INSERT INTO TIPO_PRODUCTO VALUES(2,'INSUMO');
INSERT INTO TIPO_PRODUCTO VALUES(3,'INSUMO DESECHABLE');

INSERT INTO FAMILIA_PRODUCTO VALUES(1,'IMPLANTES');
INSERT INTO FAMILIA_PRODUCTO VALUES(2,'INSUMO');
INSERT INTO FAMILIA_PRODUCTO VALUES(3,'INSUMO DESECHABLE');

INSERT INTO PRODUCTO VALUES(100,'Guantes Latex','1/1/1990',0,3300,3,3,200);
INSERT INTO PRODUCTO VALUES(200,'AGUJAS C-K JECT Long','1/1/1990',0,3900,3,3,200);
INSERT INTO PRODUCTO VALUES(300,'Separador de labios','1/1/1990',0,4200,3,3,200);

INSERT INTO SERVICIO_PRODUCTO VALUES(1,100,1);
INSERT INTO SERVICIO_PRODUCTO VALUES(1,200,1);
INSERT INTO SERVICIO_PRODUCTO VALUES(1,300,1);

INSERT INTO ORDEN_PEDIDO VALUES(1001,'En Camino','24/04/2018','1/1/1990',200,1);

INSERT INTO DETALLE_PEDIDO VALUES(1001,100,10);
INSERT INTO DETALLE_PEDIDO VALUES(1001,200,1);
INSERT INTO DETALLE_PEDIDO VALUES(1001,300,2);
INSERT INTO FACTURA VALUES(1500,'25/04/2014','78333650-2',1001,45300);

INSERT INTO STOCK VALUES(2,5,2,100);
INSERT INTO STOCK VALUES(2,5,2,200);
INSERT INTO STOCK VALUES(2,5,2,300);